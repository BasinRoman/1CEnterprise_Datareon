Функция НайтиСсылкуПоКлючуMDM(ID, СистемаИсточник, МетаданныеПолноеИмя)
	
	УстановитьПривилегированныйРежим(Истина);
	
	Если МетаданныеПолноеИмя = "Справочник.Контрагенты" или МетаданныеПолноеИмя = "Справочник.БанковскиеСчета" Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Контрагенты.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.Контрагенты КАК Контрагенты
		|ГДЕ
		|	Контрагенты.MDM_KEY = &MDM_KEY
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	БанковскиеСчета.Ссылка
		|ИЗ
		|	Справочник.БанковскиеСчета КАК БанковскиеСчета
		|ГДЕ
		|	БанковскиеСчета.MDM_KEY = &MDM_KEY";
		
		Запрос.УстановитьПараметр("MDM_KEY", ID);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		
		Если ВыборкаДетальныеЗаписи.Следующий() Тогда
			Возврат Новый Структура("Ссылка, ДатаИзменения, Эталон", ВыборкаДетальныеЗаписи.Ссылка, Дата(1,1,1), Истина)
		КонецЕсли;
		
		//Попробуем найти по guid завода 
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ахКлючиЭлементов.СсылкаНаЭлемент,
		|	ахКлючиЭлементов.ДатаИзменения,
		|	ахКлючиЭлементов.Эталон
		|ИЗ
		|	РегистрСведений.ахКлючиЭлементов КАК ахКлючиЭлементов
		|ГДЕ
		|	ахКлючиЭлементов.ID = &ID
		|	//%1
		|	//%2";
		
		Запрос.УстановитьПараметр("ID", ID);
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "//%2", "И ахКлючиЭлементов.СсылкаНаЭлемент ССЫЛКА " + МетаданныеПолноеИмя);
		
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() тогда
			Выборка = РезультатЗапроса.Выбрать();
			Выборка.Следующий();
			Возврат Новый Структура("Ссылка, ДатаИзменения, Эталон", Выборка.СсылкаНаЭлемент, Выборка.ДатаИзменения, Выборка.Эталон)
		КонецЕсли;
    
		Возврат Новый Структура("Ссылка, ДатаИзменения, Эталон", Неопределено, Дата(1,1,1), Ложь)
		//Попробуем найти по guid завода
    
	КонецЕсли;
КонецФункции

